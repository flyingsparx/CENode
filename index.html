<html>
<body>
    <div style="position:relative; height:100px;">
        <textarea style = "top:0px;left:0px;position:absolute;width:100%;max-width:100%;;margin:10px auto;z-index:2;height:50px;background:none;" id="input"></textarea>
        <textarea style = "top:0px;left:0px;position:absolute;width:100%;max-width:100%;;margin:10px auto;z-index:1;height:50px;color:rgb(150,150,150);" id="guess"></textarea>
    </div>

    <p style="font-size:10px;font-family:'Courier', 'Monospace';" id="card"></p>
    <br />
    <button id="send">Submit card to store</button>
    <hr />
    <h3>Internal representation of CEStore</h3>
    <div style="width:48%;float:left;margin-bottom:20px;">
        <p>Instances:</p>
        <textarea readonly style="width:100%;max-width:100%;height:400px;" id="instances"></textarea>
    </div>
    <div style="width:48%;float:right;margin-bottom:20px;">
        <p>Concepts:</p>
        <textarea readonly style="width:100%;max-width:100%;height:400px;" id="concepts"></textarea>
    </div>
    <p>Sentences:</p>
    <textarea readonly style="width:100%;max-width:100%;height:400px;" id="cards"></textarea>


    <script src="cestore.js"></script>  
    <script>
        var text = document.getElementById("input");
        var send = document.getElementById("send");
        var concepts = document.getElementById("concepts");
        var instances = document.getElementById("instances");
        var cards = document.getElementById("cards");
        var guess = document.getElementById("guess");
        
        var store = new cestore();    

        function refresh_content(){
            setTimeout(function(){
                var c = store.get_concepts();
                var i = store.get_instances();
                var s = store.get_sentences();
                concepts.value = JSON.stringify(c, undefined, 2);
                instances.value = JSON.stringify(i, undefined, 2);
                cards.value = JSON.stringify(s, undefined, 2);
                refresh_content();
            },200);
        }
        refresh_content();

        text.onkeyup = function(event){
            card.innerHTML = "there is a tell_card named 'msg_{uid}' that is from the individual 'test_user' and is to the agent 'Moira' and has '"+text.value.replace(/'/g, "\\'")+"' as content and has the timestamp '{now}' as timestamp.";
            guess.innerHTML = store.guess_next(text.value);               
            
        }
        text.onkeydown = function(event){
            if(event.keyCode == 9){
                text.value = store.guess_next(text.value);
                event.preventDefault();
            }
            if(event.keyCode == 13){
                send.click();
                event.preventDefault();
            }
        }
        send.onclick = function(){
            store.update_model(text.value);
            //store.receive_card(card.innerHTML);
            text.value = "";
            card.innerHTML = "";
        };
    
    </script>
</body> 
</html>
